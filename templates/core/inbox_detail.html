{% extends 'base.html' %}
{% block page_title %}Inbox Message{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-10 col-xl-9">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <a class="btn btn-sm btn-outline-secondary" href="{% url 'core:inbox' %}">
        <i class="fa-solid fa-arrow-left me-1"></i> Back to Inbox
      </a>
    </div>

    <div class="card mb-3">
      <div class="card-header">
        {{ email.subject|default:"(no subject)" }}
      </div>
      <div class="card-body">
        <div class="row g-2 small">
          <div class="col-12 col-md-6"><strong>From:</strong> {{ email.from_name }} {% if email.from_email %}&lt;{{ email.from_email }}&gt;{% endif %}</div>
          <div class="col-12 col-md-6"><strong>Date:</strong> {% if email.sent_at %}{{ email.sent_at|date:"Y-m-d H:i" }}{% else %}-{% endif %}</div>
          <div class="col-12"><strong>To:</strong> {{ email.to|default:"-" }}</div>
          {% if email.cc %}<div class="col-12"><strong>Cc:</strong> {{ email.cc }}</div>{% endif %}
        </div>

        <hr>

        {% if email.body_text %}
          <div style="white-space: pre-wrap;">{{ email.body_text }}</div>
        {% else %}
          <div class="text-muted">(No plain-text body captured for this message.)</div>
        {% endif %}
      </div>
    </div>

    {% if email.attachments.count %}
    <div class="card">
      <div class="card-header">Attachments</div>
      <div class="card-body">
        <ul class="mb-0">
          {% for a in email.attachments.all %}
            <li>
              <a href="{% url 'core:inbox_attachment_download' a.pk %}" target="_blank" rel="noopener">{{ a.filename|default:"attachment" }}</a>
              <span class="text-muted small">({{ a.size }} bytes)</span>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
    {% endif %}

  </div>
</div>
{% endblock %}
