{% extends 'base.html' %}
{% block page_title %}Search{% endblock %}

{% block content %}
<form method="get" class="mb-3">
  <div class="input-group">
    <input type="text" class="form-control" name="q" placeholder="Search the system..." value="{{ q|default:'' }}">
    <button class="btn btn-primary" type="submit">
      <i class="fa-solid fa-magnifying-glass me-1"></i> Search
    </button>
    {% if q %}
      <a class="btn btn-outline-secondary" href="{% url 'core:search' %}">Clear</a>
    {% endif %}
  </div>
</form>

{% if not q %}
  <div class="alert alert-info">Enter a keyword to search employees, documents, notices, leave, reports, and tasks.</div>
{% endif %}

{% if q %}
<div class="row g-3">
  <div class="col-12 col-lg-6">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Employees</span>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'employees:list' %}?q={{ q|urlencode }}">Open Employees</a>
      </div>
      <div class="card-body">
        <ul class="list-group list-group-flush">
          {% for e in employees %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-semibold">{{ e.user.get_full_name|default:e.user.username }}</div>
                <div class="text-muted small">{{ e.employee_id }} • {{ e.department|default:'—' }}</div>
              </div>
              <a class="btn btn-sm btn-outline-primary" href="{% url 'employees:preview' e.pk %}">Preview</a>
            </li>
          {% empty %}
            <li class="list-group-item text-muted">No employee matches.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Documents</span>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'employees:my_documents' %}">My Documents</a>
      </div>
      <div class="card-body">
        <ul class="list-group list-group-flush">
          {% for d in documents %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-semibold">{{ d.get_document_type_display }}</div>
                <div class="text-muted small">{{ d.user.get_full_name|default:d.user.username }} • {{ d.uploaded_at|date:"Y-m-d" }}</div>
                {% if d.description %}<div class="small">{{ d.description }}</div>{% endif %}
              </div>
              {% if d.file %}
                <a class="btn btn-sm btn-outline-primary" href="{{ d.file.url }}" target="_blank" rel="noopener">Open</a>
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </li>
          {% empty %}
            <li class="list-group-item text-muted">No document matches.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Notices</span>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'noticeboard:list' %}">Open Notices</a>
      </div>
      <div class="card-body">
        <ul class="list-group list-group-flush">
          {% for n in notices %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-semibold">{{ n.title }}</div>
                <div class="text-muted small">{{ n.created_at|date:"Y-m-d" }}</div>
              </div>
              <a class="btn btn-sm btn-outline-primary" href="{% url 'noticeboard:detail' n.pk %}">Open</a>
            </li>
          {% empty %}
            <li class="list-group-item text-muted">No notice matches.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Leave Requests</span>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'leave_mgmt:list' %}">Open Leave</a>
      </div>
      <div class="card-body">
        <ul class="list-group list-group-flush">
          {% for lr in leave_requests %}
            <li class="list-group-item">
              <div class="fw-semibold">{{ lr.leave_type }} • {{ lr.status }}</div>
              <div class="text-muted small">{{ lr.start_date }} → {{ lr.end_date }}</div>
            </li>
          {% empty %}
            <li class="list-group-item text-muted">No leave matches.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <div class="card h-100">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Weekly Reports</span>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'reports:weekly_list' %}">Open Reports</a>
      </div>
      <div class="card-body">
        <ul class="list-group list-group-flush">
          {% for r in weekly_reports %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <div class="fw-semibold">{{ r.employee.get_full_name|default:r.employee.username }} • Week of {{ r.week_start }}</div>
                <div class="text-muted small">Submitted {{ r.submitted_at|date:"Y-m-d" }}</div>
              </div>
              <a class="btn btn-sm btn-outline-primary" href="{% url 'reports:weekly_detail' r.pk %}">Open</a>
            </li>
          {% empty %}
            <li class="list-group-item text-muted">No report matches.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Tasks</span>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'tasks:board' %}">Open Tasks</a>
      </div>
      <div class="card-body">
        <ul class="list-group list-group-flush">
          {% for t in tasks %}
            <li class="list-group-item">
              <div class="fw-semibold">{{ t.title }}</div>
              {% if t.description %}<div class="text-muted small">{{ t.description|truncatechars:140 }}</div>{% endif %}
            </li>
          {% empty %}
            <li class="list-group-item text-muted">No task matches.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
