{% extends 'base.html' %}
{% block page_title %}Employee Documents{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div class="d-flex align-items-center gap-2">
    {% if back_url %}
      <a class="btn btn-outline-secondary btn-sm" href="{{ back_url }}">
        <i class="fa-solid fa-arrow-left me-1"></i> Back
      </a>
    {% else %}
      <a class="btn btn-outline-secondary btn-sm" href="{% url 'employees:list' %}">
        <i class="fa-solid fa-arrow-left me-1"></i> Back to Employees
      </a>
    {% endif %}
  </div>
  <div class="text-end">
    <div class="fw-semibold">{{ document_owner.get_full_name|default:document_owner.username }}</div>
    {% if employee_profile %}
      <div class="text-muted small">{{ employee_profile.employee_id }}</div>
    {% else %}
      <div class="text-muted small">{{ document_owner.username }}</div>
    {% endif %}
  </div>
</div>

<div class="d-flex justify-content-end mb-3">
  {% if can_manage_docs %}
    {% if upload_url %}
    <a class="btn btn-primary btn-sm" href="{{ upload_url }}">
      <i class="fa-solid fa-upload me-1"></i> Upload Document
    </a>
    {% else %}
    <a class="btn btn-primary btn-sm" href="{% url 'employees:document_upload' employee_profile.pk %}">
      <i class="fa-solid fa-upload me-1"></i> Upload Document
    </a>
    {% endif %}
  {% endif %}
</div>

<div class="card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-hover align-middle">
        <thead>
          <tr>
            <th>Type</th>
            <th>Description</th>
            <th>Uploaded By</th>
            <th>Uploaded At</th>
            <th>File</th>
            <th class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for d in documents %}
          <tr>
            <td class="fw-semibold">{{ d.get_document_type_display }}</td>
            <td>{{ d.description|default:"—" }}</td>
            <td>{{ d.uploaded_by|default:"—" }}</td>
            <td class="text-muted">{{ d.uploaded_at }}</td>
            <td>
              {% if d.file %}
                <a class="btn btn-sm btn-outline-primary" href="{{ d.file.url }}" target="_blank" rel="noopener">
                  <i class="fa-regular fa-file-lines me-1"></i> Open
                </a>
              {% else %}
                —
              {% endif %}
            </td>
            <td class="text-end">
              {% if can_manage_docs %}
                {% if is_my_docs %}
                  <a class="btn btn-sm btn-outline-danger" href="{% url 'employees:my_document_delete' d.pk %}">
                    <i class="fa-regular fa-trash-can me-1"></i> Delete
                  </a>
                {% else %}
                  <a class="btn btn-sm btn-outline-danger" href="{% url 'employees:document_delete' employee_profile.pk d.pk %}">
                    <i class="fa-regular fa-trash-can me-1"></i> Delete
                  </a>
                {% endif %}
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="6" class="text-muted">No documents uploaded yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
